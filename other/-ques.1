(SETQ *NOPOINT T)
(DECLARE (SPECIAL *LIST-OF-QUES*
		GROUP-OF-QUES
		ONE-QUES 
		*USER-NAME*))

(SETQ ERRLIST '((*REMARK '(SESSION LOST COMPLETELY))
		(ALARMCLOCK 'TIME -1.)
	(AND (STATUS UWRITE)(UFILE -SLOST >))
		(RE-START?)))

(SETQ IBASE 8. BASE 8.) 

;;;THE FOLLOWING DISENABLES ALL INTERUPTS EXCEPT ^Z

(SSTATUS TTY 222222222222 222222222222)

(SETQ IBASE 10. BASE 10.)

(RANDOM (FIX (TIMES (TIME) 1000.)) (RUNTIME)) 
(UWRITE)
(DEFUN READ-ANSWER NIL
(OUTPUT-ANSWER (READ-ANSWER1)))

(DEFUN OUTPUT-ANSWER (ANSWER)
((LAMBDA (^W)
(TERPRI)
(AND  ANSWER (MAPC (FUNCTION LOWER-CASE-TYO) ANSWER))) T))

(DEFUN LOWER-CASE-TYO (NCHAR)
(TYO (COND ((AND (> NCHAR 64.)
		 (< NCHAR 91.)) (+ NCHAR 32.))
	   (T NCHAR))))

(DECLARE (SPECIAL ANS))
(DEFUN READ-ANSWER1 NIL 
       (AND (EQ (ASCII (TYIPEEK)) '?) (TYI)(?-TYPED ))
       (DO ((NCHAR (TYI) (TYI)) (ANS NIL)(LAST-NCHAR -1. NCHAR))
   ((AND (= NCHAR 13.) (= LAST-NCHAR 13.))(REVERSE ANS))
	   (COND ((= NCHAR 127.) (ERASE)(AND ANS 
		 (SETQ ANS (CDR ANS))))
		 ((= NCHAR 12.) (REDISPLAY))
		((= NCHAR 7.) (QUIT?))
		((= NCHAR 8.) (BREAK?))
		((= NCHAR 19.) (OTHERS-ANSWERS))
		(T (SETQ ANS (CONS NCHAR ANS))))))

(DEFUN QUIT?
       NIL
  (*REMARK 
'(IF/ YOU/ REALLY/ WANT/ TO/ QUIT/ HIT/ THE/ SPACE/ BAR))
       (COND ((= (TYI) 32.) (IOC G))
	(T (REDISPLAY))))

(DEFUN BREAK? NIL
(*REMARK 
'(IF/ YOU/ REALLY/ WANT/ TO/ ^H/ BREAK/ THEN/ HIT/ THE/ SPACE/ BAR))
(COND( (= (TYI) 32.) (IOC H))
	(T (REDISPLAY)))) 

(DEFUN ERASE NIL 
       ((LAMBDA (L C ^R) (COND ((= C 0.) NIL)
			       (T (CURSORPOS L (1- C))
				  (PRINC '/ )
				  (CURSORPOS L (1- C))
				  (TYO 127.))))
	(CAR (CURSORPOS))
	(CDR (CURSORPOS))
	NIL)) 

(DEFUN ?-TYPED NIL 
       (*REMARK '(TYPE WHATEVER
		       ANSWER
		       YOU
		       FEEL
		       APPROPRIATE/,
		       IF
		       YOU
		       FEEL
		       THAT
		       THE
		       PROBLEM
		       IS
		       UNCLEAR
		       EXPLAIN
		       WHY
		       YOU
		       THINK
		       IT
		       UNCLEAR))) 

(DEFUN *REMARK (X) 
       (TERPRI)
       (PRINC '/././.)
       (MAPC (FUNCTION (LAMBDA (Q) (COND ((> (LENGTH (EXPLODE Q))
					     CHRCT)
					  (TERPRI)
					  (PRINC '/ / / )))
				   (PRINC Q)
				   (PRINC '/ )))
	     X)
       (TERPRI)
       (ASCII 0.)) 

(DEFUN TOP-LEVEL
       NIL
       (SAY-INTRO)
       (FINISH-UP (MAPCAR (FUNCTION DO-GROUP)
			  (SETQ *LIST-OF-QUES*
				(APPEND (SHUFFLE (CDR
						  (REVERSE
						   *LIST-OF-QUES*)))
					(LAST *LIST-OF-QUES*))))))
(DEFUN RE-START? NIL 
(*REMARK '(IF YOU WANT TO TRY AGAIN HIT THE SPACE BAR))
(COND ((= (TYI) 32.)(UWRITE)(IOC R)
   (FINISH-UP(MAPCAR (FUNCTION DO-GROUP)  *LIST-OF-QUES*))) 
	(T (SUICIDE))))

(DEFUN SAY-INTRO NIL
(*REMARK '(OK I/'M GOING TO ASK YOU A FEW QUESTIONS
 JUST REPLY HOWEVER YOU FEEL IS APPROPRIATE/.
	THE MACHINE IS ONLY RECORDING YOUR ANSWERS/.
  TRY TO GIVE THE REASONS FOR YOUR ANSWERS WHEN CONVIENIENT/.
	YOU MAY TYPE CNTL-L AT ANY TIME TO
	 REDISPLAY SCREEN AND QUESTION/./
   ALL ANSWERS ARE TERMINATED BY TWO CARRIAGE
 RETURNS IN SUCESSION/.  IF YOU ARE INTERESTED
 IN HOW MY PROGRAM ANSWERS THE SAME QUESTIONS
 SEE ME (KEN RM 835.)/. THANKS FOR YOUR HELP/.))(IOC R)
(*REMARK '(WHAT IS YOUR NAME? YOU MAY SKIP THIS IF
	 YOU PLEASE))
(SETQ *USER-NAME* (OR (AND (SETQ *USER-NAME* (READ-ANSWER))
		(IMPLODE *USER-NAME*)) 
		'NAME/ NOT/ GIVEN)))

(DEFUN DO-GROUP
       (GROUP-OF-QUES)
       (CURSORPOS 'C)
       (DISPLAY (CAR GROUP-OF-QUES) T)
       (CONS (CAR GROUP-OF-QUES)
	     (MAPCAR (FUNCTION DO-QUES)
		     (SHUFFLE (CDR GROUP-OF-QUES))))) 

(DECLARE (SPECIAL QUES-TEXT))
(DEFUN REDISPLAY
       NIL
       (PROG (^R)
	     (CURSORPOS 'C)
	     (DISPLAY (CAR GROUP-OF-QUES) NIL)
	     (*REMARK QUES-TEXT)
	     (PRINC (IMPLODE (REVERSE ANS)))))
(DECLARE (SPECIAL LIST-OF-ANSWERS))
(DEFUN OTHERS-ANSWERS NIL
(MAPC (FUNCTION *REMARK) LIST-OF-ANSWERS)
(ASCII 0.))



(DEFUN DO-QUES (ONE-QUES) 
       ((LAMBDA ( QUES-TEXT LIST-OF-ANSWERS) 
		(*REMARK QUES-TEXT)
		(APPEND (CONS (CAR ONE-QUES) LIST-OF-ANSWERS)
			(LIST (FIX-UP+READ-ANSWER))))
	(CADR (CAR ONE-QUES))
	(CDR ONE-QUES))) 

(DEFUN FIX-UP+READ-ANSWER NIL 
       ((LAMBDA (OTIME) (LIST (IMPLODE (READ-ANSWER))
			      '/
BY			      *USER-NAME*
			      'TOOK
			      (-$ (TIME) OTIME)
			      'SECONDS))
	(TIME))) 
 


 

(DEFUN NTH (X N) 
       (AND (NUMBERP N)
	    (DO ((I X (CDR I)) (J 1. (1+ J)))
		((OR (= J N) (NULL I)) (AND I (CAR I)))))) 

(DEFUN SHUFFLE (LIST) 
       (MAPCAR (FUNCTION (LAMBDA (NUMBER) (NTH LIST NUMBER)))
	       (N-NUMBERS (LENGTH LIST)))) 

(DEFUN N-NUMBERS (N) 
       (DO ((ANS NIL)
	    (N-LEFT N)
	    (RANDOM-N (1+ (RANDOM N)) (1+ (RANDOM N))))
	   ((ZEROP N-LEFT) ANS)
	   (COND ((MEMQ RANDOM-N ANS))
		 (T (SETQ ANS (CONS RANDOM-N ANS))
		    (SETQ N-LEFT (1- N-LEFT))))))

 

(DEFUN FINISH-UP (LIST-OF-ANSWERS)
(*REMARK '(THANKS FOR YOUR HELP/. GOODBYE/.))
(UFILE -OQUES >)
(RECORD-ACCUM-ANSWERS LIST-OF-ANSWERS))

(DEFUN RECORD-ACCUM-ANSWERS (*LIST-OF-QUES*)
(PROG (^W)
(*REMARK '(PLEASE WAIT A SECOND WHILE I RECORD THINGS))
(UWRITE) (IOC R)
(SETQ ^W T)
(PRINT (LIST 'SETQ '*LIST-OF-QUES*  (LIST'QUOTE *LIST-OF-QUES*)))
(UFILE -AQUES >)
(SETQ ^W NIL)
(SUICIDE)))

(DEFUN SUICIDE NIL
(*REMARK '(HIT THE SPACE BAR TO SUICIDE))
(AND (= (TYI) 32.) (VALRET '/:KILL//
)))

(DECLARE (SPECIAL SECONDS ALARMCLOCK))
(DEFUN COUNT-DOWN (MESSAGE SECONDS) 
       (*REMARK (LIST 'YOU/ HAVE
		      SECONDS
		      'SECONDS/ TO/ READ/ THIS))
       (*REMARK MESSAGE)
       (CURSORPOS 20. 4.)
       (PRINC 'SECONDS/ LEFT)
       (SETQ ALARMCLOCK (FUNCTION THE-TIMER))
       (ALARMCLOCK 'TIME 1.)
       (SLEEP (PLUS 0.5 SECONDS))
	(ALARMCLOCK 'TIME -1.)(CURSORPOS 'C)) 

(DEFUN THE-TIMER (FOO) 
(PROG (^R)
       (COND ((> SECONDS 1.)
	      (SETQ SECONDS (1- SECONDS))
	      (CURSORPOS 20. 0.)
	      (PRINC SECONDS)
	      (ALARMCLOCK 'TIME 1.))
	     (T (CURSORPOS 'C)))))

(DECLARE (UNSPECIAL SECONDS)) 

(DEFUN DISPLAY (GROUP-INTRO NEW-SW)
(COND ((NUMBERP (CAR GROUP-INTRO))(AND NEW-SW 
	(COUNT-DOWN (CDR GROUP-INTRO)
			(CAR GROUP-INTRO))))
	(T (*REMARK GROUP-INTRO))))
(UREAD -AQUES >)
(IOC Q)
(EVAL (READ))
 (SETQ ^Q NIL)
(TOP-LEVEL)